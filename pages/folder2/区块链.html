<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能合约 | 首页</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/egg.png">
    <meta name="description" content="曾先森的后端记录">
    <link rel="preload" href="/assets/css/0.styles.0559e1a2.css" as="style"><link rel="preload" href="/assets/js/app.53968dc3.js" as="script"><link rel="preload" href="/assets/js/2.f9c1d4bc.js" as="script"><link rel="preload" href="/assets/js/11.97ba27c5.js" as="script"><link rel="prefetch" href="/assets/js/10.96fa90b8.js"><link rel="prefetch" href="/assets/js/3.91f1c807.js"><link rel="prefetch" href="/assets/js/4.bbb8263b.js"><link rel="prefetch" href="/assets/js/5.d7cf43f2.js"><link rel="prefetch" href="/assets/js/6.e80d54fa.js"><link rel="prefetch" href="/assets/js/7.8723cd86.js"><link rel="prefetch" href="/assets/js/8.c89eeea4.js"><link rel="prefetch" href="/assets/js/9.759a7a31.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0559e1a2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/egg.png" alt="首页" class="logo"> <span class="site-name can-hide">首页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">文章</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/folder1/工作.html" class="nav-link">
  后台
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder2/区块链.html" class="nav-link">
  区块链
</a></li></ul></div></div><div class="nav-item"><a href="/pages/folder1/test3.html" class="nav-link">
  功能演示
</a></div><div class="nav-item"><a href="https://github.com/zengdewei1" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">文章</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/folder1/工作.html" class="nav-link">
  后台
</a></li><li class="dropdown-item"><!----> <a href="/pages/folder2/区块链.html" class="nav-link">
  区块链
</a></li></ul></div></div><div class="nav-item"><a href="/pages/folder1/test3.html" class="nav-link">
  功能演示
</a></div><div class="nav-item"><a href="https://github.com/zengdewei1" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>区块链</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/folder2/区块链.html" class="active sidebar-link">区块链</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/folder2/区块链.html#智能合约" class="sidebar-link">智能合约</a></li><li class="sidebar-sub-header"><a href="/pages/folder2/区块链.html#bfc-2-0" class="sidebar-link">BFC 2.0</a></li><li class="sidebar-sub-header"><a href="/pages/folder2/区块链.html#algo算法" class="sidebar-link">Algo算法</a></li><li class="sidebar-sub-header"><a href="/pages/folder2/区块链.html#filecoin共识算法" class="sidebar-link">filecoin共识算法</a></li><li class="sidebar-sub-header"><a href="/pages/folder2/区块链.html#非中心化的数据结构" class="sidebar-link">非中心化的数据结构</a></li><li class="sidebar-sub-header"><a href="/pages/folder2/区块链.html#ipfs" class="sidebar-link">IPFS</a></li><li class="sidebar-sub-header"><a href="/pages/folder2/区块链.html#教程资源" class="sidebar-link">教程资源</a></li><li class="sidebar-sub-header"><a href="/pages/folder2/区块链.html#log-2" class="sidebar-link">Log</a></li><li class="sidebar-sub-header"><a href="/pages/folder2/区块链.html#lotus" class="sidebar-link">lotus</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="智能合约"><a href="#智能合约" class="header-anchor">#</a> 智能合约</h2> <p>高老师牵头的，学校5G联创实验室肖泳老师的项目，联邦学习与区块链的结合，把ai放区块链上跑</p> <p>训练的参数和中间结果上链，使得模型之间互不影响，模型的产出</p> <p>分布式AI</p> <p>实时性</p> <p>go</p> <h2 id="bfc-2-0"><a href="#bfc-2-0" class="header-anchor">#</a> BFC 2.0</h2> <p>分账算法</p> <h2 id="algo算法"><a href="#algo算法" class="header-anchor">#</a> Algo算法</h2> <h2 id="filecoin共识算法"><a href="#filecoin共识算法" class="header-anchor">#</a> filecoin共识算法</h2> <p>存储证明的共识算法</p> <p><a href="https://github.com/filecoin-project/rust-fil-proofs" target="_blank" rel="noopener noreferrer">rust-fil-proofs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>Filecoin Proving Subsystem</strong> (or FPS)</p> <p>Filecoin最具特色的功能之一是其可验证的存储方式</p> <h3 id="filecoin理论基础"><a href="#filecoin理论基础" class="header-anchor">#</a> Filecoin理论基础</h3> <p><a href="https://proto.school/verifying-storage-on-filecoin" target="_blank" rel="noopener noreferrer">教程:	Verifying Storage on Filecoin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="_0、存储和数据准备、传输"><a href="#_0、存储和数据准备、传输" class="header-anchor">#</a> 0、存储和数据准备、传输</h4> <h5 id="激励存储"><a href="#激励存储" class="header-anchor">#</a> 激励存储</h5> <p>Filecoin 增加了一个激励层，用于在分散的 Web 上促进长期、可验证的存储</p> <h5 id="加密证明"><a href="#加密证明" class="header-anchor">#</a> 加密证明</h5> <p>Filecoin 用于验证存储的加密证明**，称为复制证明 （PoRep）** <strong>和时空证明 （PoSt）</strong></p> <p>Filecoin 协议不提供加密，但您可以使用它来存储加密数据</p> <p>区块链通常使用工作证明（意味着计算或处理能力），而 Filecoin 的证明是有用存储的证明（一种赌注证明）</p> <h5 id="准备和传输数据"><a href="#准备和传输数据" class="header-anchor">#</a> 准备和传输数据</h5> <p>系统文件转化为Filecoin Piece</p> <p>有唯一的CIDs，即DAG的根节点</p> <h5 id="转化步骤"><a href="#转化步骤" class="header-anchor">#</a> 转化步骤</h5> <p>创建IPLD DAG（定向非循环图）， 序列化成CAR文件并填充位</p> <p>sector（扇区）：基本的存储单元</p> <p>扇区是 Filecoin 中的基本存储单元，可以包含来自多个交易和客户端的片段</p> <p>piece CID 包装得到Deal Proposal（由客户生成）</p> <p>deal CID包括矿工和客户的身份以及其他重要的交易细节，以piece CID的形式</p> <p><img src="https://pic1.zhimg.com/80/v2-cd5e51c473429b66cd630fa6a0757e13_720w.jpg" alt="img"></p> <h4 id="_1、porep"><a href="#_1、porep" class="header-anchor">#</a> 1、PoRep</h4> <p>就是Proof of Replicate 复制证明</p> <p>运行一次以证明矿工在扇区密封时存储了数据的物理唯一副本</p> <h5 id="填充扇区并生成-commd"><a href="#填充扇区并生成-commd" class="header-anchor">#</a> 填充扇区并生成 CommD</h5> <p>扇区满后，将生成 CommD（Commitment of Data, aka UnsealedSectorCID），表示扇区中包含的所有片断 CID 的根节点。</p> <h5 id="密封扇区并生成-commr"><a href="#密封扇区并生成-commr" class="header-anchor">#</a> 密封扇区并生成 CommR</h5> <p>生成独立副本，副本的merkle树的根哈希是 CommRLast，在矿机私有保存</p> <p>CommRLast 和 CommitC（另一个merkle根输出）一起哈希生成CommR（Commitment of Replication, aka SealedSectorCID），并公开到区块链</p> <p>node.go代码在启动挖矿时，每120个区块调用一次SealAllStagedSectors函数（将所有的Staged的Sector数据进行Seal）。</p> <p>在filecoin-proof模块接收到请求后，确认目前所有的Staged的Sector，并对每个Sector进行Seal。</p> <p><strong>Replica ID</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>rust-fil-proofs/storage-proofs/src/seal.rs

seal_pre_commit_phase1
seal_pre_commit_phase2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>storage_proofs::porep::stacked::generate_replica_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2、post"><a href="#_2、post" class="header-anchor">#</a> 2、PoSt</h4> <p>（Proof of Space Time) 时空证明</p> <p>重复运行以证明他们随着时间的推移继续将存储空间专用于同一数据</p> <p>随机选择一些叶子节点，运行merkle包含证明</p> <p>CommRLast CommR</p> <h4 id="_3、zk-snarks"><a href="#_3、zk-snarks" class="header-anchor">#</a> 3、zk - SNARKs</h4> <p>零知识的简介非交互式的知识参数，可视为计算哈希</p> <p>Filecoin 中的复制证明和时空过程证明都使用 zk-SNARK 进行压缩</p> <p>计算成本高，但最终产品小，数百 KB 的证明压缩为 192 字节，减小存储；同时验证过程非常快</p> <h3 id="filecoin-porep和post算法源代码导读"><a href="#filecoin-porep和post算法源代码导读" class="header-anchor">#</a> <a href="https://zhuanlan.zhihu.com/p/60849559" target="_blank" rel="noopener noreferrer">Filecoin - PoRep和PoSt算法源代码导读<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <ol><li><p>go-filecoin</p></li> <li><p>rust-fil-proofs</p></li> <li><p>bellman(zk-SNARKs)</p></li></ol> <p>filecoin-proofs实现了filecoin存储证明的接口，依赖其他两个模块：storage-proofs（存储证明的逻辑）和 sector-base （数据存储的接口）。这两个模块又依赖于storage-backend模块实现数据的存储。</p> <p><strong>PoRep的生成和验证逻辑</strong></p> <p><strong>PoSt的生成和验证逻辑</strong></p> <p>PoRep是对某个Sector数据存储的证明，每个Sector一次。PoSt是一系列已经Seal过的Sector的存储证明，每隔一段时间一次。两个证明的核心是Groth16零知识验证算法</p> <p>在一个存储矿工存储（Seal）用户数据后，每隔20000个区块，必须提供一次PoSt（Proof of Space Time)的证明</p> <p>某个存储矿工还存有用户数据的证明。20000个区块，一个区块30秒，也就说每6天提交一次证明</p> <h4 id="rust-fil-proofs的框架"><a href="#rust-fil-proofs的框架" class="header-anchor">#</a> rust-fil-proofs的框架</h4> <ul><li><p>storage-proofs：库 A <strong>library</strong> for constructing storage proofs – including non-circuit proofs, corresponding SNARK circuits, and a method of combining them</p></li> <li><p>Filecoin Proofs：storage-proofs的封装, FFI-exported <strong>API</strong> callable from C (and in practice called by <a href="https://github.com/filecoin-project/lotus" target="_blank" rel="noopener noreferrer">lotus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> via cgo).</p></li></ul> <h3 id="存储管理"><a href="#存储管理" class="header-anchor">#</a> 存储管理</h3> <p>Store - Sector存储系统 一般32G</p> <p>包含3种存储，unsealed， cache，sealed</p> <p>Worker通过jsonRPC通信，Worker1处理P1，Worker2处理P2</p> <p>AddPiece 在unsealed中创建原始数据</p> <p>PreCommit1 针对SDR算法，计算若干层数据 11层结构 32G * 11</p> <p>PreCommit2 生成Replica，计算Column Hash，创建merkle树(tree_d，tree_c，tree_r_last)</p> <p>当sector32G时</p> <ul><li>原始数据 - 32G</li> <li>原始数据 Mercle - 32G</li> <li>P1 layer - 32G * 11</li> <li>P2 Column Hash &amp; tree_c - 32*2G</li> <li>P2 Replica &amp; tree_r_last - 32G + 9.2M * 8</li></ul> <p>Commit生成证明后，finalize归档会删除不需要持久化的数据，持久化的数据传输回Manager</p> <h3 id="零知识证明-zksnark入门"><a href="#零知识证明-zksnark入门" class="header-anchor">#</a> 零知识证明 - zkSNARK入门</h3> <p>NP 非确定性多项式 不能在多项式内可解，但可以验证；NP问题可以相互归约</p> <p>QSP（基于布尔电路的NP问题的证明和验证）是个NP问题：给定一系列的多项式，以及给定一个目标多项式，找出多项式的组合能整除目标多项式</p> <p>QAP（基于算术电路的NP问题），有更好的普适性</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/IXicdJl0t7b6YpP4WZ3AxGRsoBglEb4WQxZrKuXgpHs8dp7yQ6YKTI7vR2fTlEcquuTlOTInpPeaibibzYLzHHlnQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p> <p>1/ 问题转化:  一个需要证明的NP问题转化为选定的NP问题（比如QSP问题）</p> <p>2/ 设置参数（setup）：设置参数的过程也是挑选随机数的过程，并提供CRS</p> <p>3/ 证明者获取证据u，通过CRS计算证据（proof）</p> <p>4/ 验证者验证证据以及响应的proof</p> <p>证据（Witness）u</p> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/IXicdJl0t7b6YpP4WZ3AxGRsoBglEb4WQ7p23hltvKPz8WXJ9K2BND1LQ2gx8evBiaGibaHFphu9hVibKL11QvrPJA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p> <h3 id="bellman源码"><a href="#bellman源码" class="header-anchor">#</a> bellman源码</h3> <p><img src="https://mmbiz.qpic.cn/mmbiz_png/IXicdJl0t7b5oaDhzxs3AP6MczGibs8nSzupOrqibA73H3NKxtbtVxjMTywxPiaKDGuV7kVcbHbNvjDIcr5gMSxzrQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img"></p> <p>总体流程</p> <p>1.将问题多项式拍平（flatten），构建对应的电路（Circuit）</p> <p>（这一步是由上层应用程序配置的）
2.根据电路生成R1CS（Rank 1 Constraint System）
3.将R1CS转化为QAP（Quadratic Arithmetic Program）。传统做法是通过拉格朗日插值，但是为了降低计算复杂度，可以通过快速傅立叶变换来实现。
4.初始化QAP问题的参数，即CRS（Common Reference Strings）
5.根据CRS和输入创建proof
6.验证proof</p> <p>Parameters</p> <p>Variable类型代表输入数据中的每一个值，分为公开的statement数据和私有的witness数据：</p> <ul><li>Input类型：即statement数据</li> <li>Aux类型：即witness数据</li></ul> <p>ConstraintSystem产生Input、Aux类型的变量</p> <p>Circuit的synthesize()会调用ConstraintSystem的enforce()构建R1CS</p> <p>KeypairAssembly是ConstraintSystem的一个实现，R1CS的参数会保存在其成员变量中</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token namespace">groth16<span class="token punctuation">::</span>generator<span class="token punctuation">::</span></span><span class="token function">generate_parameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">let</span> <span class="token keyword">mut</span> assembly <span class="token operator">=</span> <span class="token class-name">KeypairAssembly</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Synthesize the circuit.</span>
    circuit<span class="token punctuation">.</span><span class="token function">synthesize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> assembly<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
	<span class="token comment">// Use inverse FFT to convert powers of tau to Lagrange coefficients</span>
    powers_of_tau<span class="token punctuation">.</span><span class="token function">ifft</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>worker<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">None</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> powers_of_tau <span class="token operator">=</span> powers_of_tau<span class="token punctuation">.</span><span class="token function">into_coeffs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>3、创建Proof</p> <p>生成proof的时候使用的是ConstraintSystem的另外一个实现ProvingAssignment来调用Circuit的synthesize()函数</p> <p>显然我们是不能除以零的，因此需要对x做一定的“变换”或者“偏移”。用bellman里的术语，叫做从“Evaluation Domain”转换到“Coset”上</p> <p>4、验证阶段</p> <h3 id="任务"><a href="#任务" class="header-anchor">#</a> 任务</h3> <p>rust-fli-proof代码在cpu/gpu的对比测试
微服务模式
目前filecoin的存储证明模块都是调用rust-fli-proof，在耗时部分的测试后，我们的工作是将rust部分做成一个单独的微服务架构（考虑能充分利用gpu加速）</p> <p>winning-post?</p> <p>window-post？</p> <p>改变文件大小进行测试 4K 1M</p> <h3 id="测试结果"><a href="#测试结果" class="header-anchor">#</a> 测试结果</h3> <h4 id="_1、run-merkleproofs-bench"><a href="#_1、run-merkleproofs-bench" class="header-anchor">#</a> 1、run_merkleproofs_bench</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>cargo run --release --bin benchy -- merkleproofs --size 2

info!(
    &quot;generating merkle tree for sector size {} [base_tree_leaves {}, tree_count {}]&quot;,
    size, base_tree_leaves, tree_count
);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2、winning-post"><a href="#_2、winning-post" class="header-anchor">#</a> 2、winning-post</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>info!(&quot;Benchy Winning PoSt: sector-size={}&quot;, sector_size,);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="C:%5CUsers%5Czengdewei1%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200831085629874.png" alt="image-20200831085629874"></p> <p><img src="C:%5CUsers%5Czengdewei1%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200831122522982.png" alt="image-20200831122522982"></p> <p><img src="C:%5CUsers%5Czengdewei1%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200831151020726.png" alt="image-20200831151020726"></p> <p><img src="C:%5CUsers%5Czengdewei1%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200902181635124.png" alt="image-20200902181635124"></p> <h4 id="_3、window-post"><a href="#_3、window-post" class="header-anchor">#</a> 3、window-post</h4> <p><img src="C:%5CUsers%5Czengdewei1%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200831085704959.png" alt="image-20200831085704959"></p> <p>This is required since hashers are dependent on sector size</p> <p><img src="C:%5CUsers%5Czengdewei1%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200902183844955.png" alt="image-20200902183844955"></p> <h4 id="_4、prodbench"><a href="#_4、prodbench" class="header-anchor">#</a> 4、prodbench</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>cargo run --release --bin benchy -- prodbench --config prodbench_inputs.json

prodbench_inputs.json
{
 &quot;sector_size&quot;: &quot;2048&quot;,
 &quot;porep_challenges&quot;: 4,
 &quot;porep_partitions&quot;: 1,
 &quot;post_challenges&quot;: 2,
 &quot;post_challenged_nodes&quot;: 4,
 &quot;stacked_layers&quot;: 2,
 &quot;num_sectors&quot;: 1
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h5 id="代码逻辑"><a href="#代码逻辑" class="header-anchor">#</a> 代码逻辑</h5> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token namespace">prodbench<span class="token punctuation">::</span></span>run<span class="token punctuation">{</span>
    <span class="token namespace">shared<span class="token punctuation">::</span></span>create_replicas<span class="token punctuation">{</span>
        <span class="token namespace">shared<span class="token punctuation">::</span></span>create_piece
        filecoin<span class="token operator">-</span><span class="token namespace">proofs<span class="token punctuation">::</span>api<span class="token punctuation">::</span></span><span class="token function">add_piece</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//数据补充完整</span>
        <span class="token namespace">filecoin_proofs<span class="token punctuation">::</span>api<span class="token punctuation">::</span>seal<span class="token punctuation">::</span></span><span class="token function">seal_pre_commit_phase1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//数据编码</span>
        <span class="token namespace">filecoin_proofs<span class="token punctuation">::</span>api<span class="token punctuation">::</span>seal<span class="token punctuation">::</span></span><span class="token function">seal_pre_commit_phase2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//生成树结构</span>
    <span class="token punctuation">}</span>
    <span class="token namespace">filecoin_proofs<span class="token punctuation">::</span>api<span class="token punctuation">::</span>seal<span class="token punctuation">::</span></span><span class="token function">seal_commit_phase1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//准备电路、存储证明需要的数据</span>
    <span class="token namespace">filecoin_proofs<span class="token punctuation">::</span>api<span class="token punctuation">::</span>seal<span class="token punctuation">::</span></span><span class="token function">seal_commit_phase2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//生成零知识证明{</span>
    	<span class="token namespace">storage_proofs_core<span class="token punctuation">::</span>compound_proof<span class="token punctuation">::</span></span><span class="token class-name">CompoundProof</span><span class="token punctuation">::</span><span class="token function">circuit_proof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//输入params,生成groth proof</span>
            <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">circuit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//构建CompoundProof's bellperson::Circuit</span>
            <span class="token namespace">bellperson<span class="token punctuation">::</span>groth16<span class="token punctuation">::</span>prover<span class="token punctuation">::</span></span><span class="token function">create_random_proof_batch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token namespace">prover<span class="token punctuation">::</span></span><span class="token function">create_random_proof_batch_priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token namespace">prover<span class="token punctuation">::</span></span><span class="token function">create_proof_batch_priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token namespace">rayon<span class="token punctuation">::</span></span><span class="token class-name">ThreadPool</span> <span class="token operator">=</span> <span class="token namespace">rayon<span class="token punctuation">::</span></span><span class="token class-name">ThreadPoolBuilder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token namespace">rayon<span class="token punctuation">::</span>multicore<span class="token punctuation">::</span></span><span class="token constant">THREAD_POOL</span><span class="token punctuation">{</span>
                <span class="token function">install</span><span class="token punctuation">(</span><span class="token namespace">prover<span class="token punctuation">::</span></span><span class="token function">create_proof_batch_priority_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token namespace">locks<span class="token punctuation">::</span>locked_kernel<span class="token punctuation">::</span></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token namespace">gpu<span class="token punctuation">::</span>locks<span class="token punctuation">::</span></span><span class="token class-name">LockedFFTKernel</span><span class="token punctuation">-&gt;</span><span class="token namespace">gpu<span class="token punctuation">::</span>fft<span class="token punctuation">::</span></span><span class="token class-name">FFTKernel</span><span class="token punctuation">,</span><span class="token namespace">domain<span class="token punctuation">::</span></span>create<span class="token operator">-</span>fft<span class="token operator">-</span>kernel<span class="token punctuation">;</span>
                    fft_kern <span class="token operator">=</span> <span class="token namespace">gpu<span class="token punctuation">::</span>fft<span class="token punctuation">::</span></span><span class="token class-name">FFTKernel</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        devices <span class="token operator">=</span> rust<span class="token operator">-</span>gpu<span class="token operator">-</span><span class="token namespace">tools<span class="token punctuation">::</span>opencl<span class="token punctuation">::</span></span><span class="token class-name">Device</span><span class="token punctuation">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        devices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        src <span class="token operator">=</span> <span class="token namespace">gpu<span class="token punctuation">::</span>sources<span class="token punctuation">::</span></span>kernel
                        <span class="token namespace">opencl<span class="token punctuation">::</span></span><span class="token class-name">Program</span><span class="token punctuation">::</span><span class="token function">from_opencl</span><span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        program<span class="token punctuation">.</span><span class="token function">create_buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                    <span class="token class-name">EvaluationDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    a<span class="token punctuation">.</span><span class="token function">ifft</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>worker<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> fft_kern<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
                    a<span class="token punctuation">.</span><span class="token function">coset_fft</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>worker<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> fft_kern<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
                    b<span class="token punctuation">.</span><span class="token function">ifft</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>worker<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> fft_kern<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
                    b<span class="token punctuation">.</span><span class="token function">coset_fft</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>worker<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> fft_kern<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
                    c<span class="token punctuation">.</span><span class="token function">ifft</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>worker<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> fft_kern<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
                    c<span class="token punctuation">.</span><span class="token function">coset_fft</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>worker<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> fft_kern<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span><span class="token comment">//-&gt;fft();//陪衬</span>
                    <span class="token namespace">gpu<span class="token punctuation">::</span></span><span class="token function">multiexp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Arc</span><span class="token punctuation">(</span>rayon<span class="token operator">-</span><span class="token namespace">core<span class="token punctuation">::</span>registry<span class="token punctuation">::</span></span><span class="token class-name">Registry</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">in_worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//没有线程就创建线程</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

vanilla proofs<span class="token operator">?</span>
<span class="token class-name">DefaultOctLCTree</span><span class="token operator">?</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>rust-gpu-tools</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Buffer Brand Device Program
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ocl</p> <h4 id="_5、rust-gpu-tools"><a href="#_5、rust-gpu-tools" class="header-anchor">#</a> 5、rust-gpu-tools</h4> <p><img src="C:%5CUsers%5Czengdewei1%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200902184537572.png" alt="image-20200902184537572"></p> <p><img src="C:%5CUsers%5Czengdewei1%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200907214132511.png" alt="image-20200907214132511"></p> <p><img src="C:%5CUsers%5Czengdewei1%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200902171823778.png" alt="image-20200902171823778"></p> <h4 id="问题及解决"><a href="#问题及解决" class="header-anchor">#</a> 问题及解决</h4> <h5 id="os-error-13"><a href="#os-error-13" class="header-anchor">#</a> os error 13</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo chown -R $(whoami) /Users/lowesyang/.cargo/
拥有者皆设为I，群体的使用者 无
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="parameter不存在"><a href="#parameter不存在" class="header-anchor">#</a> Parameter不存在</h4> <p>文件路径在<code>/var/tmp/filecoin-proof-parameters</code>，运行<code>cargo run --bin settings</code>可以查看</p> <h4 id="上传参数文件"><a href="#上传参数文件" class="header-anchor">#</a> 上传参数文件</h4> <p>https://proofs.filecoin.io/</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>scp -P2222 v28-stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793b06832f.* public@dian.org.cn:/home/public

scp -P44013 v28-proof-of-spacetime-fallback-merkletree-poseidon_hasher-8-0-0-0170db1f394b35d995252228ee359194b13199d259380541dc529fb0099096b0.* root@115.156.207.239:/var/tmp/filecoin-proof-parameters/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="批量下载参数"><a href="#批量下载参数" class="header-anchor">#</a> 批量下载参数</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">params</span><span class="token operator">=</span><span class="token punctuation">(</span>v28-stacked-proof-of-replication-merkletree-poseidon_hasher-8-0-0-sha256_hasher-032d3138d22506ec0082ed72b2dcba18df18477904e35bafee82b3793b06832f. v28-proof-of-spacetime-fallback-merkletree-poseidon_hasher-8-0-0-50c7368dea9593ed0989e70974d28024efa9d156d585b7eea1be22b2e753f331. v28-proof-of-spacetime-fallback-merkletree-poseidon_hasher-8-0-0-0170db1f394b35d995252228ee359194b13199d259380541dc529fb0099096b0. v28-proof-of-spacetime-fallback-merkletree-poseidon_hasher-8-0-0-3ea05428c9d11689f23529cde32fd30aabd50f7d2c93657c1d3650bca3e8ea9e.<span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable">${params<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token punctuation">;</span>
<span class="token keyword">do</span>
	<span class="token function">wget</span> https://proofs.filecoin.io/<span class="token variable">${i}</span>params
	<span class="token function">wget</span> https://proofs.filecoin.io/<span class="token variable">${i}</span>vk
<span class="token keyword">done</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="log"><a href="#log" class="header-anchor">#</a> LOG</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>fn main() {
    fil_logger::init();
}

RUST_LOG=filecoin_proofs=info
RUST_LOG=trace
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>测试间隔时间</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token class-name">Instant</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">...</span>
<span class="token keyword">let</span> proof_time <span class="token operator">=</span> start<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">&quot;groth_proof_time: {:?}&quot;</span><span class="token punctuation">,</span> proof_time<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-rust line-numbers-mode"><pre class="language-rust"><code>fil<span class="token operator">-</span>proofs<span class="token operator">-</span><span class="token namespace">tooling<span class="token punctuation">::</span></span>measure <span class="token punctuation">-&gt;</span> cpu_time wall<span class="token operator">-</span>time
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="opencl"><a href="#opencl" class="header-anchor">#</a> OpenCL</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo cp -a /usr/local/cuda-10.0/include/CL/* /usr/local/include
sudo cp -a /usr/local/cuda-10.0/lib64/* /usr/lib
sudo echo '/usr/local/cuda-10.0/lib64/' &gt;&gt; /etc/ld.so.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>sudo apt-get install nvidia-410-uvm nvidia-opencl-dev nvidia-modprobe nvidia-libopencl1-410 nvidia-opencl-icd-410
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>clinfo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看GPU</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>lshw -C video
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装参考</p> <p>https://www.cnblogs.com/vactor/p/9286425.html</p> <p>安装驱动</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$version=450
sudo apt-get install nvidia-&lt;$version&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>sudo apt-get install nvidia-opencl-dev nvidia-modprobe nvidia-libopencl1-$version nvidia-opencl-icd-$version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>修改文件大小</p> <p>修改参数</p> <p>docker内部安装驱动</p> <p>在默认情况下Docker是不能访问任何device的, 为了能在Docker里访问显卡,必须加上--privileged=true的选项</p> <p>为了能够在容器里面打开显示器,我们还需要在启动时指定DISPLAY</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>wget https://cn.download.nvidia.com/XFree86/Linux-x86_64/${VSESION_NAME}/NVIDIA-Linux-x86_64-${VSESION_NAME}.run
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="进展"><a href="#进展" class="header-anchor">#</a> 进展</h3> <h4 id="_2020-9-6"><a href="#_2020-9-6" class="header-anchor">#</a> 2020.9.6</h4> <h5 id="gpu-nvidia-1080ti"><a href="#gpu-nvidia-1080ti" class="header-anchor">#</a> GPU: 	Nvidia 1080Ti</h5> <table><thead><tr><th>步骤</th> <th>不使用GPU</th> <th>使用OpenCL的耗时 ssector-size：2K</th> <th>OpenCL sector-size：16K</th> <th>OpenCL 128K</th> <th>1M</th></tr></thead> <tbody><tr><td>add_piece数据补充完整</td> <td>1</td> <td>1</td> <td>0</td> <td>4</td> <td>32</td></tr> <tr><td>precommit parse1数据编码</td> <td>59</td> <td>34</td> <td>50</td> <td>151</td> <td>432</td></tr> <tr><td>precommit parse2生成树结构</td> <td>83</td> <td>83</td> <td>163</td> <td>211</td> <td>439</td></tr> <tr><td>commit1准备电路需要的数据</td> <td>5</td> <td>7</td> <td>10</td> <td>12</td> <td>14</td></tr> <tr><td>commit2生成零知识证明</td> <td>64877</td> <td>25896</td> <td>28998</td> <td>30793</td> <td>35444</td></tr> <tr><td></td> <td></td> <td></td> <td></td> <td></td> <td></td></tr> <tr><td></td> <td></td> <td></td> <td></td> <td></td> <td></td></tr> <tr><td></td> <td></td> <td></td> <td></td> <td></td> <td></td></tr> <tr><td></td> <td></td> <td></td> <td></td> <td></td> <td></td></tr></tbody></table> <div class="language- line-numbers-mode"><pre class="language-text"><code>RUST_LOG=INFO RUST_BACKTRACE=1 cargo run --release --bin benchy -- prodbench --config prodbench_inputs.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>主要耗时在零知识证明，使用OpenCL时耗时25秒；</p> <p>零知识证明使用bellperson库，bellperson库会调用rust-gpu-tools库。</p> <p>rust-gpu-tools库使用OpenCL，调用ifft函数进行快速傅里叶变换，multiexp进行幂指数运算。</p> <p>bellman用cuda改写的相关代码仓库</p> <h5 id="belle-cuda"><a href="#belle-cuda" class="header-anchor">#</a> belle_cuda</h5> <p>包含ifft multiexp</p> <p>parallel-bellman-ford</p> <h4 id="_2020-9-17"><a href="#_2020-9-17" class="header-anchor">#</a> 2020.9.17</h4> <p>学习PoRep和PoSt的计算过程</p> <p>学习零知识证明基础</p> <p>阅读bellman源码</p> <h2 id="非中心化的数据结构"><a href="#非中心化的数据结构" class="header-anchor">#</a> 非中心化的数据结构</h2> <p>Decentralized Data Structures</p> <p>内容寻址如何使我们能够信任分散 Web 上的对等方。内容寻址和内容标识符 （CID） 的概念是了解 Filecoin 如何验证存储的关键</p> <h2 id="ipfs"><a href="#ipfs" class="header-anchor">#</a> IPFS</h2> <p>星际文件系统</p> <p>merkle树</p> <p>DAG</p> <h2 id="教程资源"><a href="#教程资源" class="header-anchor">#</a> 教程资源</h2> <p><a href="https://proto.school" target="_blank" rel="noopener noreferrer">关于分布式Web 协议的交互式教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://proto.school/verifying-storage-on-filecoin/resources" target="_blank" rel="noopener noreferrer">Filecoin相关教程和论文<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://proto.school/anatomy-of-a-cid" target="_blank" rel="noopener noreferrer">CID的解剖<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://spec.filecoin.io/" target="_blank" rel="noopener noreferrer">Filecoin Spec<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>公众号-星想法</p> <p>[bellman源码分析](https://zhuanlan.zhihu.com/p/75539022</p> <h2 id="log-2"><a href="#log-2" class="header-anchor">#</a> Log</h2> <p>学习PoRep和PoSt的计算过程</p> <p>学习零知识证明基础</p> <p>阅读bellman源码</p> <h5 id="安装cmake"><a href="#安装cmake" class="header-anchor">#</a> 安装cmake</h5> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> https://cmake.org/files/v3.18/cmake-3.18.2-Linux-x86_64.tar.gz
<span class="token function">tar</span> zxvf cmake-3.14.0.tar.gz
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> build-essential <span class="token comment"># gcc g++</span>
<span class="token function">mv</span> cmake-3.18.2-Linux-x86_64 /opt/cmake-3.18.2
<span class="token function">ln</span> -sf /opt/cmake-3.18.2/bin/*  /usr/bin/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>配置文件</p> <p><img src="C:%5CUsers%5Czengdewei1%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200917091018303.png" alt="image-20200917091018303"></p> <p>erc智能合约</p> <p>转到tfc开发任务，也是存储，另外一种架构</p> <p>tfc和filecoin连接</p> <p>erc和esa</p> <p>数据存储在bfc上，tfc制作bonus</p> <p>任务：增加点以及绘制图</p> <p>存储证明的抽取：</p> <p>看懂lotus调用api的过程</p> <p>windows-post进行证明，seal过程不用，关心存储和验证，</p> <p>自己的seed种子发送，返回一个验证</p> <p>给一个证明，得到结果</p> <h2 id="lotus"><a href="#lotus" class="header-anchor">#</a> lotus</h2> <p>编译安装</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> mesa-opencl-icd ocl-icd-opencl-dev gcc <span class="token function">git</span> bzr jq pkg-config <span class="token function">curl</span>

<span class="token function">wget</span> -c https://dl.google.com/go/go1.14.2.linux-amd64.tar.gz -O - <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tar</span> -xz -C /usr/local
<span class="token builtin class-name">echo</span> <span class="token string">&quot;export PATH=<span class="token environment constant">$PATH</span>:/usr/local/go/bin&quot;</span> <span class="token operator">&gt;&gt;</span> ~/.profile
<span class="token builtin class-name">source</span> <span class="token environment constant">$HOME</span>/.profile
<span class="token comment"># 启用 Go Modules 功能</span>
go <span class="token function">env</span> -w <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on
go <span class="token function">env</span> -w <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://mirrors.aliyun.com/goproxy/,direct

<span class="token function">env</span> <span class="token function">env</span> <span class="token assign-left variable">RUSTFLAGS</span><span class="token operator">=</span><span class="token string">&quot;-C target-cpu=native -g&quot;</span> <span class="token assign-left variable">FFI_BUILD_FROM_SOURCE</span><span class="token operator">=</span><span class="token number">1</span> <span class="token function">make</span> clean deps all
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>

<span class="token comment"># clang安装</span>
<span class="token function">wget</span> -O - https://apt.llvm.org/llvm-snapshot.gpg.key <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
apt-add-repository <span class="token string">&quot;deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-6.0 main&quot;</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y clang-6.0

<span class="token comment"># 更新子模块</span>
<span class="token function">git</span> submodule init
<span class="token function">git</span> submodule update
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><a href="https://juejin.im/post/6844904039067418638" target="_blank" rel="noopener noreferrer">源码分析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://blog.studygolang.com/2012/12/go%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/" target="_blank" rel="noopener noreferrer">GO项目的目录结构<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>作用到底是啥，给我的要求是存储证明的生成和验证接口，但是前提需要有区块和矿机地址等信息</p> <p>完整的存储会包含所有的过程，只是precommit2，作为Sealer的方法</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">9/9/2020, 3:55:07 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.53968dc3.js" defer></script><script src="/assets/js/2.f9c1d4bc.js" defer></script><script src="/assets/js/11.97ba27c5.js" defer></script>
  </body>
</html>
